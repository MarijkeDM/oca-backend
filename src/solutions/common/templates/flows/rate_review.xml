<?xml version="1.0" encoding="utf-8"?>
<messageFlowDefinitionSet xmlns="https://rogerth.at/api/1/MessageFlow.xsd">
    <definition name="rate_review"
                language="{{ language }}"
                startReference="{%if ratings%}message_total_ratings{% else %}message_rate{% endif %}">

        <end id="end_cancel" waitForFollowUpMessage="false"/>
        <end id="end_sent" waitForFollowUpMessage="true"/>

        {% if ratings %}
        <formMessage id="message_total_ratings"
                     alertIntervalType="NONE"
                     alertType="SILENT"
                     brandingKey="{{ branding_key }}"
                     positiveReference="message_rate"
                     vibrate="false"
                     autoLock="true"
                     negativeReference="end_cancel">
            <content>{% translate language, "common", "total_ratings" %}</content>
            <form positiveButtonConfirmation=""
                  negativeButtonCaption="{% translate language, 'common', 'Cancel' %}"
                  positiveButtonCaption="{% translate language, 'common', 'Rate this service' %}"
                  negativeButtonConfirmation="">
                <widget xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:type="RatingWidget">
                    {% for rating in ratings %}
                    <topic id="{{ rating.topic.name }}" score="{{ rating.score }}" total_count="{{ rating.total_count }}">
                        <title>{{ rating.topic.title }}</title>
                        <question></question>
                    </topic>
                    {% endfor %}
                </widget>
            </form>
        </formMessage>
        {% endif %}

        <formMessage id="message_rate"
                     alertIntervalType="NONE"
                     alertType="SILENT"
                     brandingKey="{{ branding_key }}"
                     positiveReference="flush_rating"
                     vibrate="false"
                     autoLock="true"
                     negativeReference="end_cancel">
            <content>{% translate language, 'common', 'please_rate_every_topic' %}</content>
            <form positiveButtonConfirmation=""
                  negativeButtonCaption="{% translate language, 'common', 'Cancel' %}"
                  positiveButtonCaption="{% translate language, 'common', 'Submit' %}"
                  negativeButtonConfirmation="">
                <widget xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:type="RatingWidget">
                    {% for topic in topics %}
                    <topic id="{{ topic.name }}" score="2.5" total_count="0">
                        <title>{{ topic.title }}</title>
                        <question>{{ topic.question }}</question>
                    </topic>
                    {% endfor %}
                </widget>
            </form>
        </formMessage>

        <!--
        <formMessage id="message_review"
                     alertIntervalType="NONE"
                     alertType="SILENT"
                     brandingKey="{{ branding_key }}"
                     positiveReference="flush_rating"
                     vibrate="false"
                     autoLock="true"
                     negativeReference="end_cancel">
            <content>{% translate language, 'common', 'optional_review' %}</content>
            <form positiveButtonConfirmation=""
                  negativeButtonCaption="{% translate language, 'common', 'Cancel' %}"
                  positiveButtonCaption="{% translate language, 'common', 'Next' %}"
                  negativeButtonConfirmation="">
                <widget xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xsi:type="TextBlockWidget"
                        maxChars="1000"
                        keyboardType="DEFAULT"/>
                <javascriptValidation></javascriptValidation>
            </form>
        </formMessage>
        -->

        <resultsFlush id="flush_rating"
                      reference="end_sent"/>
    </definition>
</messageFlowDefinitionSet>
